<style>
  *{box-sizing:border-box}
  body{margin:0;font-family:Arial,Helvetica,sans-serif;background:#f5f5f5}
  .card{background:#fff;width:600px;max-width:100%;padding:26px 22px 36px;border-radius:10px;box-shadow:0 6px 16px rgba(0,0,0,.08);overflow:auto;max-height:90vh;margin:20px auto}
  /* Report mode: let the page (not the card) scroll */
  .card.report-mode{max-height:none;overflow:visible}

  .progress-container{width:100%;background:#e0e0e0;border-radius:4px;margin-bottom:24px;overflow:hidden}
  .progress-bar{width:0%;height:8px;background:#0087FB;border-radius:4px;transition:width .2s}
  .question{font-size:1.25rem;margin-bottom:1rem;line-height:1.45}
  .options button{width:100%;padding:12px 16px;margin-bottom:14px;border:1px solid #ccc;border-radius:6px;background:#f9f9f9;font-size:1rem;cursor:pointer;text-align:left;color:#333}
  .options button.selected{background:#e6f3ff;border-color:#0087FB;color:#0087FB;font-weight:700}
  .nav-buttons{display:flex;gap:10px;margin-top:6px}
  #backBtn,#nextBtn,#downloadBtn,#resetBtn{width:100%;padding:12px 16px;border:none;border-radius:6px;font-size:1.05rem;cursor:pointer;text-align:center}
  #backBtn{background:#e0e0e0;color:#333}
  #backBtn:disabled{background:#f5f5f5;color:#aaa;cursor:not-allowed}
  #nextBtn{background:#0087FB;color:#fff;opacity:.5}
  #nextBtn.enabled{opacity:1}
  #downloadBtn{background:#0087FB;color:#fff;margin-top:20px}
  #resetBtn{background:#e0e0e0;color:#333;margin-top:10px}
  #signUpBtn{display:block;text-decoration:none;background:#0087FB;color:#fff;margin-top:10px;padding:12px 16px;border-radius:6px;font-size:1.05rem;text-align:center}
  .cta-subtext{text-align:center;font-size:.8rem;color:#666;margin-top:5px;margin-bottom:20px}
  #progressWrap{text-align:center}.progressText{margin-bottom:10px;font-size:1.05rem}
  .barOuter{width:100%;background:#e0e0e0;border-radius:6px;overflow:hidden;height:14px;margin:0 auto}
  .barInner{width:0%;height:100%;background:#0087FB}
  .discount-banner{background:#f9f9f9;color:#333;padding:20px;border:1px solid #e0e0e0;border-radius:8px;text-align:center;margin-bottom:20px}
  #timer{font-weight:700;font-size:1.1rem;letter-spacing:1px;color:#0087FB}
  .plan-section{padding:20px;border:1px solid #e0e0e0;border-radius:8px;background:#fdfdfd;text-align:left}

  /* Tiny extra space between emoji headings and divider line */
  .plan-section h3{
    font-size:1.35rem;color:#333;border-bottom:2px solid #e0e0e0;
    padding-bottom:12px;
    margin:24px 0 16px;
  }
  .plan-section h3:first-child{margin-top:10px}
  .plan-section p,.plan-section li,.plan-section td{line-height:1.6;color:#555}
  .plan-section ul{list-style:none;padding-left:2.2em}
  .plan-section ul li{position:relative;padding-left:.5em;margin-bottom:.5em}
  .plan-section ul li::before{content:'âœ“';position:absolute;left:-1.5em;color:#0087FB;font-weight:700}

  /* Slider */
  .slider-container{padding:8px 0 16px}
  #sliderValue{font-size:1.1rem;font-weight:700;color:#0087FB;margin:2px 0 10px}
  .slider{-webkit-appearance:none;appearance:none;width:100%;height:12px;border-radius:9999px;background:linear-gradient(90deg,#e5e7eb,#d1d5db);outline:none}
  .slider:hover{filter:brightness(98%)}
  .slider::-webkit-slider-runnable-track{height:12px;border-radius:9999px;background:linear-gradient(90deg,#e5e7eb,#d1d5db)}
  .slider::-webkit-slider-thumb{-webkit-appearance:none;width:26px;height:26px;border-radius:50%;background:#fff;border:3px solid #0087FB;box-shadow:0 2px 4px rgba(0,0,0,.15);margin-top:-7px;cursor:pointer}
  .slider::-moz-range-track{height:12px;border-radius:9999px;background:linear-gradient(90deg,#e5e7eb,#d1d5db)}
  .slider::-moz-range-thumb{width:26px;height:26px;border-radius:50%;background:#fff;border:3px solid #0087FB;box-shadow:0 2px 4px rgba(0,0,0,.15);cursor:pointer}
  .slider-labels{display:flex;justify-content:space-between;font-size:.9rem;color:#666;margin-top:8px}

  /* CLEAN PDF MODE */
  body.pdf-export-mode{background:#fff}
  body.pdf-export-mode .card{box-shadow:none;max-width:900px;margin:0 auto}
  body.pdf-export-mode #offerContainer,
  body.pdf-export-mode #downloadBtn,
  body.pdf-export-mode #resetBtn{display:none !important}

  /* === Vertical routine cards (mobile-first) === */
  .routine-vertical{display:grid;gap:12px;margin-top:6px}
  .rv-item{border:1px solid #e5e7eb;background:#fff;border-radius:8px;padding:12px 14px}
  .rv-title{font-weight:700;color:#333;margin-bottom:6px}
  .rv-line{margin:2px 0;color:#555}
  .rv-label{font-weight:700;color:#444}
</style>

<div class="card" id="quiz"></div>

<!-- External libs for PDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" referrerpolicy="no-referrer"></script>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const DISCOUNT_URL = 'https://www.lukepriddy.com/offers/LEkHeSLU?coupon_code=ACTION';
  const REPORT_DELAY_MS = 8000; // 8s

  const quizDiv = document.getElementById('quiz');
  let timerInterval;

  // Safe storage shim
  const safeStore = (() => {
    const mem = {};
    const ok = (t)=>{try{const s=window[t];const k='__p__';s.setItem(k,'1');s.removeItem(k);return s;}catch(e){return null;}};
    const ss = ok('sessionStorage'), ls = ok('localStorage');
    return {
      getS:(k)=> ss?ss.getItem(k):mem['s_'+k]||null,
      setS:(k,v)=>{if(ss)ss.setItem(k,v);else mem['s_'+k]=v;},
      getL:(k)=> ls?ls.getItem(k):mem['l_'+k]||null,
      setL:(k,v)=>{if(ls)ls.setItem(k,v);else mem['l_'+k]=v;},
      rmL:(k)=>{if(ls)ls.removeItem(k);else delete mem['l_'+k];},
      rmS:(k)=>{if(ss)ss.removeItem(k);else delete mem['s_'+k];}
    };
  })();

  // ---------- Content library (RESTORED) ----------
  const blocks = {
    overview: {
      career: (reasons, skills) => `<h3>Overview</h3><p>You are learning English for <strong>${reasons}</strong> and want to improve <strong>${skills}</strong>. The <strong>English Fluency in 90 Days</strong> program has five courses (50+ hours) taught by <strong>Luke</strong>. Each day you complete assignments, then practice with Lukeâ€™s AI assistant <strong>Cathy ðŸ¤–</strong>, who corrects grammar and runs realistic job role-plays.</p>`,
      travel: (reasons, skills) => `<h3>Overview</h3><p>You are learning English for <strong>${reasons}</strong>. You want better <strong>${skills}</strong>. After each section, have a focused session with Lukeâ€™s AI assistant <strong>Cathy ðŸ¤–</strong> to practice assignments and common situations. Travel role-play scenarios arenâ€™t the focus of the program, but Luke can provide a custom list to help you with that (just ask).</p>`,
      personal: (reasons, skills) => `<h3>Overview</h3><p>You are learning English for <strong>${reasons}</strong>. You want stronger <strong>${skills}</strong>. The five-course 90-day program (50+ hours) is taught by <strong>Luke</strong>, and is designed help you build a solid foundation of the habits and skills necessary to become fluent in English, once and for all. Cathy, Lukeâ€™s AI assistant, will provide feedback in assignments throughout the program, and help you practice conversation and speaking skills.</p>`,
      enthusiastic: (reasons, skills) => `<h3>Overview</h3><p>You enjoy learning, which is great! To improve <strong>${skills}</strong>, you will need to work hard, which means not just learning and watching lessons, but also doing assignments, and practicing. This program is designed to give you a solid foundation of habits and skills to help you become fluent in English once and for all. In the program, you will complete lessons by Luke, and then practice assignments with <strong>Cathy ðŸ¤–</strong>, Lukeâ€™s AI assistant. You can also get help from Luke as you go.`,
      limited: `<h3>Overview</h3><p>Youâ€™re a busy person. Itâ€™s hard to make time for things like English fluency, but where there is a will, there is a way. The key is to focus your study and practice time in a few blocks during the week, doing practice and reviewing feedback while you are doing other things, like having your morning coffee, or taking the bus. Lukeâ€™s 90-day fluency program can be just as impactful for someone learning on the go. Doing assignments and practicing can be done anywhere, using your phone, with Lukeâ€™s AI assistant Cathy. Flexibility is the key to success.</p>`
    },

    /* === NEW vertical layout for the routine === */
    dailyRoutine: {
      hour: `
        <h3>ðŸ“… Recommended Daily Routine</h3>
        <div class="routine-vertical">
          <div class="rv-item">
            <div class="rv-title">Lesson</div>
            <div class="rv-line"><span class="rv-label">Time:</span> 35 min</div>
            <div class="rv-line"><span class="rv-label">What to do:</span> Work through the next lesson and note key phrases.</div>
          </div>
          <div class="rv-item">
            <div class="rv-title">Assignment + Practice</div>
            <div class="rv-line"><span class="rv-label">Time:</span> 20 min</div>
            <div class="rv-line"><span class="rv-label">What to do:</span> Finish the assignment and practice new language or skills learned.</div>
          </div>
          <div class="rv-item">
            <div class="rv-title">Chat with Cathy</div>
            <div class="rv-line"><span class="rv-label">Time:</span> 10 min</div>
            <div class="rv-line"><span class="rv-label">What to do:</span> Role-play and get corrections.</div>
          </div>
        </div>`,
      half: `
        <h3>ðŸ“… Recommended Daily Routine</h3>
        <div class="routine-vertical">
          <div class="rv-item">
            <div class="rv-title">Lesson</div>
            <div class="rv-line"><span class="rv-label">Time:</span> 35 min</div>
            <div class="rv-line"><span class="rv-label">What to do:</span> Work on the next chunk of lessons in the correct order.</div>
          </div>
          <div class="rv-item">
            <div class="rv-title">Assignment + Practice</div>
            <div class="rv-line"><span class="rv-label">Time:</span> 15 min</div>
            <div class="rv-line"><span class="rv-label">What to do:</span> Complete the assignment and do additional practice based on new things learned, if there is time.</div>
          </div>
          <div class="rv-item">
            <div class="rv-title">Chat with Cathy</div>
            <div class="rv-line"><span class="rv-label">Time:</span> 10 min</div>
            <div class="rv-line"><span class="rv-label">What to do:</span>
